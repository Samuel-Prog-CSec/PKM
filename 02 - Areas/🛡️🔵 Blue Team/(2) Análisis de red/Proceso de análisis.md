El [[Proceso de análisis]] es un proceso dinámico que puede cambiar dependiendo de las herramientas que tengamos a mano, los permisos que nos otorgue la organización y la visibilidad de nuestra red. Nuestro objetivo es proporcionar un proceso repetible que podamos comenzar a utilizar al realizar análisis de tráfico.

El análisis de tráfico es una `examenacion detellada de un evento o un proceso`, determinando su origen e impacto, que puede utilizarse para desencadenar precauciones y/o acciones específicas para apoyar o prevenir sucesos futuros. Con el tráfico de red, esto significa dividir los datos en fragmentos comprensibles, examinarlos en busca de cualquier cosa que se desvíe del tráfico de red normal, de tráfico potencialmente malicioso, como comunicaciones remotas no autorizadas desde Internet a través de RDP, SSH o Telnet, o instancias únicas que preceden a problemas de red. Al realizar nuestro análisis, también buscamos ver cómo se ven las tendencias dentro del tráfico y determinar si coincide con una línea base del tráfico operativo típico.

El análisis de tráfico es una herramienta muy versátil y esencial para tener en nuestra caja de herramientas defensivas. Sin la capacidad de monitorear el tráfico, estamos trabajando con una enorme pieza del rompecabezas faltante. Los análisis sobre el uso de la red, los servidores y hosts que hablan por los medios y las comunicaciones internas son piezas cruciales que nos brindan a nosotros, los administradores y defensores, una forma de ver y corregir problemas antes o poco después de que ocurran. La visibilidad es probablemente lo más beneficioso que proporciona. Con esta visibilidad, podemos capturar el tráfico durante diferentes períodos para establecer una línea de base para nuestro entorno. Esta línea de base hace que sea más fácil ver cuándo se ha producido un cambio. En implementaciones más avanzadas para NTA que incluyen otras herramientas como IDS/IPS, firewalls, registros de host y red, e información adicional que se introduce en herramientas como Splunk o ELK Stack,Tener la capacidad de monitorear el tráfico es invaluable. Las herramientas nos ayudan a alertar rápidamente sobre acciones maliciosas que ocurren. Muchas herramientas defensivas tienen firmas creadas para la mayoría de los ataques y kits de herramientas comunes.

Tener capacidades defensivas adecuadas es vital para todos, pero ¿qué pasa con las operaciones diarias? ¿Cómo puede ayudarnos la NTA? Observar el tráfico de la red en vivo puede facilitar la solución de un problema de conexión o determinar si nuestra infraestructura y los protocolos correspondientes funcionan correctamente. Si podemos ver hacia dónde va el tráfico, podemos determinar si hay algún problema.

Por último, se trata de una habilidad dinámica y está perfectamente bien utilizar herramientas automatizadas para ayudarnos. Simplemente no confíes únicamente en ellos. Utilice las habilidades que tiene y realice comprobaciones manuales también. Esto nos ayudará poniendo los ojos en nuestra red. Tendremos controles y equilibrios entre nosotros y las herramientas, ya que las herramientas pueden ser derrotadas. Los actores maliciosos están encontrando formas de eludir las medidas de seguridad todo el tiempo. El ojo humano sigue siendo nuestro mejor recurso para encontrar lo malo.

---

# Dependencias de análisis
La captura y el análisis del tráfico se pueden realizar de dos formas diferentes: `active` o `passive`. Cada uno tiene sus dependencias. Con pasivo, simplemente copiamos datos que podemos ver sin interactuar directamente con los paquetes. Para la captura y análisis activo del tráfico, las necesidades son un poco diferentes. La captura activa requiere que adoptemos un enfoque más práctico. Este proceso también puede denominarse `in-line` capturas de tráfico. Con ambos, la forma en que analizamos los datos depende de nosotros. Podemos realizar la captura y el análisis una vez realizado, o podemos realizar el análisis en tiempo real mientras el tráfico está activo. La siguiente tabla establece las dependencias para cada uno.

## Dependencias de captura de tráfico

| **Dependencias**                          | **Pasivo**  | **Activo**  | **Descripción**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ----------------------------------------- | ----------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Permission`                              | :luc_check: | :luc_check: | Dependiendo de la organización en la que trabajemos, la captura de datos puede ir en contra de las políticas o incluso de la ley en algunas áreas sensibles como la atención médica o la banca. Asegúrese siempre de obtener permiso por escrito de alguien con la autoridad adecuada para otorgárselo. Podemos presentarnos como hackers, pero queremos permanecer en la luz legal y éticamente.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `Mirrored Port`                           | :luc_check: | ☐           | Una interfaz de red de conmutador o enrutador configurada para copiar datos de otras fuentes a esa interfaz específica, junto con la capacidad de colocar su NIC en modo promiscuo. Tener paquetes copiados a nuestro puerto nos permite inspeccionar cualquier tráfico destinado a otros enlaces sobre los que normalmente no podríamos tener visibilidad. Dado que las VLAN y los puertos de conmutación no reenviarán tráfico fuera de su dominio de transmisión, debemos estar conectados al segmento o copiar ese tráfico a nuestro puerto específico. Cuando se trata de tecnología inalámbrica, la pasiva puede ser un poco más complicada. Debemos estar conectados al SSID del que deseamos capturar el tráfico. Simplemente escuchar pasivamente las ondas de radio que nos rodean nos presentará muchos anuncios de transmisión SSID, pero no mucho más. |
| `Capture Tool`                            | :luc_check: | :luc_check: | Una forma de ingerir el tráfico. Una computadora con acceso a herramientas como TCPDump, Wireshark, Netminer u otras es suficiente. Tenga en cuenta que cuando se trabaja con datos PCAP, estos archivos pueden volverse bastante grandes rápidamente. Cada vez que le aplicamos un filtro en herramientas como Wireshark, hace que la aplicación analice esos datos nuevamente. Este puede ser un proceso que requiera muchos recursos, así que asegúrese de que el host tenga recursos abundantes.                                                                                                                                                                                                                                                                                                                                                                |
| `In-line Placement`                       | ☐           | :luc_check: | Colocar un Tap en línea requiere un cambio de topología para la red en la que está trabajando. Los hosts de origen y destino no notarán una diferencia en el tráfico, pero para enrutar y cambiar, será un siguiente salto invisible por el que pasará el tráfico en su camino hacia el destino.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `Network Tap or Host With Multiple NIC's` | ☐           | :luc_check: | Se requiere una computadora con dos NIC o un dispositivo como Network Tap para permitir que los datos que estamos inspeccionando sigan fluyendo. Piense en ello como agregar otro enrutador en medio de un enlace. Para capturar activamente el tráfico, duplicaremos datos directamente de las fuentes. La mejor ubicación para un grifo es en un enlace de capa tres entre segmentos conmutados. Permite capturar cualquier ruta de tráfico fuera de la red local. Un puerto conmutado o una segmentación de VLAN no filtran nuestra vista aquí.                                                                                                                                                                                                                                                                                                                  |
| `Storage and Processing Power`            | :luc_check: | :luc_check: | Necesitará mucho espacio de almacenamiento y potencia de procesamiento para capturar el tráfico de un grifo. Mucho más tráfico atraviesa un enlace de capa tres que sólo dentro de una LAN conmutada. Piénselo así: cuando capturamos pasivamente el tráfico dentro de una LAN, es como verter agua en una taza desde una fuente de agua. Es un flujo constante pero manejable. Captar activamente el tráfico de un enlace enrutado es más como usar una manguera de agua para llenar una taza de té. Hay mucha más presión detrás del flujo y puede ser mucho para que el anfitrión la procese y almacene.                                                                                                                                                                                                                                                         |

La última dependencia es más una recomendación que un requisito, pero creemos necesario mencionarla. Comprender cómo fluye el tráfico diario es fundamental para tener éxito. Es posible realizar análisis de tráfico sin uno, pero será mucho más difícil y llevará mucho tiempo. La línea base nos permitirá filtrar rápidamente el tráfico común de esa red mientras realizamos nuestro análisis. Hacerlo puede acelerar nuestro proceso y ayudar a detectar valores atípicos o problemas mucho antes. Veamos este escenario por un segundo:

 Eres administrador de red de una gran corporación con varios miles de empleados en el campus. Se le ha informado que un segmento de su red tiene problemas de conectividad. Varios de esos hosts informan una latencia extremadamente alta y aparecen nuevos archivos en sus escritorios. Para comenzar a obtener una imagen de lo que está sucediendo, conecta una computadora a ese segmento e inicia una captura. Después de que hayan pasado unos minutos, detienes la captura y comienzas tu análisis.

Ahora considere esto. Sin una línea base de nuestro tráfico diario de red, ¿cómo sabemos qué es típico de esa red? Capturamos un montón de información durante el período de captura y necesitamos borrar parte de ella. Este proceso puede llevar mucho tiempo ya que tendremos que examinar cada conversación para asegurarnos de que esté bien, determinar si los hosts que vemos pertenecen a la red o son activos fraudulentos, entre mucho más. Este proceso rápidamente se convirtió en una tarea abrumadora, ¿verdad?

Con este escenario y el acceso a una línea base de red, podemos eliminar rápidamente las comunicaciones que se sabe que funcionan bien. El uso de herramientas de análisis de datos, como el módulo de los principales hablantes en Wireshark, puede ayudar a identificar hosts que pueden estar enviando una gran cantidad de datos. Podemos comparar esto con la línea base normal del anfitrión para determinar si está fuera de lugar. Otra forma podría ser observar las conexiones entre hosts internos o puertos comunes y poco comunes. Como pudimos aclarar nuestra vista, ahora podemos ver que varios hosts de usuario se conectan en los puertos 8080 y 445. Los puertos en sí no son extraños, pero el hecho de que sean dos PC de usuario las que se comuniquen entre sí a través de estos puertos sí lo es. El tráfico web generalmente fluye desde un host a un servidor web alojado o a un servidor web de intranet que aloja aplicaciones comerciales. Lo mismo puede decirse del tráfico de PYMES.Es muy sospechoso ver a dos anfitriones hablando entre sí a través de este puerto. Con lo que sabemos ahora, podemos enviar rápidamente un ticket de problemas buscando ayuda para manejar una posible infracción ahora.